(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9561],{3912:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/document/high-function/multi-progress",function(){return n(4521)}])},9369:function(e,s,n){"use strict";var r=n(5893);n(7294);let i={logo:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("img",{style:{width:"40px",marginRight:"10px"},src:"data:image/png;base64,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"}),(0,r.jsx)("strong",{children:"Yunfly"})]}),project:{link:"https://github.com/yunke-yunfly/doc.github.io",icon:(0,r.jsx)("svg",{height:"32","aria-hidden":"true",viewBox:"0 0 16 16",version:"1.1",width:"32","data-view-component":"true",children:(0,r.jsx)("path",{d:"M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"})})},docsRepositoryBase:"https://github.com/yunke-yunfly/doc.github.io",feedback:{content:"问题? 请反馈给我们 ->"},sidebar:{defaultMenuCollapseLevel:1},head:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("meta",{property:"og:title",content:"yunfly-doc"}),(0,r.jsx)("meta",{property:"og:description",content:"一款高效的 Node.js Web 框架。"})]})};s.Z=i},4521:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return y}});var r=n(5893),i=n(4319),l=n(2840),o=n(9369);n(9966);var t=n(1151),c=n(5675),a=n.n(c),d={src:"/doc.github.io/_next/static/media/1646709519899-0-image.2254b529.png",height:1440,width:1621,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAIAAAC6O5sJAAAAdElEQVR42jWNQQ4DIQwD+f9fq20WSEgch8KhF2s0luwGQE1JqioyWWVmVdWOWrGki7mRWTyRe+9WdfmQD9Xn671XxC14PQHIR5auozLzTgXCYtkyJAgUkIm9qz1jPlP3QfLtr8grY3zVGv8fJ6fbdDcP9fgBIWSj+z/Tb0sAAAAASUVORK5CYII=",blurWidth:8,blurHeight:7},h={src:"/doc.github.io/_next/static/media/JxRGY4BYNd1617277289391-1617277289391.99029f70.png",height:334,width:994,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAAAAACLoxGUAAAAIUlEQVR42gWAgREAIAgC2X/fEp+yTkAm82RvWH1F55SLDz0PF282PbtZAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:3},x={src:"/doc.github.io/_next/static/media/1646709581135-0-image.2a18416f.png",height:1440,width:1890,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAATlBMVEX//////v7+/v7//f3+/f39/f38/f3+/Pz9/Pz8/Pz9+/v8+/v7+/v8+vr7+vr6+vr7+fn6+fn5+fn6+Pj5+Pj69/f59vb39vb29fX18vIj43F6AAAAN0lEQVR42gVAiRGAIAxLpBoEP6xI3X9RD0aL/VICp7WWV0TWcZ/zkvF127y3AXnEqDCwPN7E9AM2EwIlgVPFwAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:6},k={src:"/doc.github.io/_next/static/media/7QHfWFpzrW1617268910564-1617268910564.ccb33efd.png",height:393,width:1463,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAIAAADq9gq6AAAAOklEQVR42mMw8HDVcHZQtLeWtrGUtTSVVVOTk9eQU1Bj0LMxMbG20DMx0zIzldNRl5WXlZOVlZWVBQDfTgg8KzGbHAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:2},p={src:"/doc.github.io/_next/static/media/1646709650706-0-image.927d28f4.png",height:850,width:2142,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAIAAAAhqtkfAAAAR0lEQVR42jXLIRKAMAxE0W4mAyUVcP+rgQMEuq4ZssTw9P9wd6Z4dZoFKD8E+dzXuR+2btWWQgJSzdB7H8MzYUTeqtqaicgHAQcfkaBxgw8AAAAASUVORK5CYII=",blurWidth:8,blurHeight:3};function j(e){let s=Object.assign({h1:"h1",p:"p",h2:"h2",ol:"ol",li:"li",code:"code",pre:"pre",span:"span",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",h3:"h3",ul:"ul",blockquote:"blockquote",a:"a"},(0,t.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{children:"多进程模型"}),"\n",(0,r.jsx)(s.p,{children:"Node.js 进程只能运行在一个 CPU 上，无法充分利用多核CPU。\nNode.js 官方提供cluster模块，Yunfly 框架内置 cluster 能力。"}),"\n",(0,r.jsx)(s.h2,{id:"cluster-是什么",children:"cluster 是什么"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"在服务器上同时启动多个进程"}),"\n",(0,r.jsx)(s.li,{children:"每个进程里都跑的是同一份源代码"}),"\n",(0,r.jsx)(s.li,{children:"这些进程可以同时监听一个端口"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"使用",children:"使用"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"yunfly"})," 已内置 ",(0,r.jsx)(s.code,{children:"cluster"})," 插件，只需进行开启即可。"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"ts","data-theme":"default",filename:"src/config/config.default.ts",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"ts","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"config"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".cluster "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  enable"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"true"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,r.jsx)(s.p,{children:"详细配置说明"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"字段"}),(0,r.jsx)(s.th,{children:"类型"}),(0,r.jsx)(s.th,{children:"必选"}),(0,r.jsx)(s.th,{children:"说明"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"enable"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"boolean"})}),(0,r.jsx)(s.td,{children:"是"}),(0,r.jsx)(s.td,{children:"是否开启集群环境，不开启则保持以前状态"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"useAloneWorker"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"boolean"})}),(0,r.jsx)(s.td,{children:"否"}),(0,r.jsx)(s.td,{children:"是否开启 alone 进程（默认：true）"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"count"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"number"})}),(0,r.jsx)(s.td,{children:"否"}),(0,r.jsx)(s.td,{children:"worker进程数（默认开发环境1个进程，生产环自动获取docker容器的cpu核数）"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"env"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"Object"})}),(0,r.jsx)(s.td,{children:"否"}),(0,r.jsx)(s.td,{children:"cluster进程能获取到的环境env变量，（默认 process.env）"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"title"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"否"}),(0,r.jsx)(s.td,{children:"cluster集群组名称 （默认： yunfly-{{package.name}}）"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"mode"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"null | test"})}),(0,r.jsx)(s.td,{children:"否"}),(0,r.jsx)(s.td,{children:"运行模型，若值为test时，开发环境可自定义 count 数量"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"进程分类",children:"进程分类"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"yunfly cluster"})," 参考了 ",(0,r.jsx)(s.code,{children:"egg cluster"})," 模型理念，设计了 3 种分类。如下图："]}),"\n",(0,r.jsx)(s.pre,{"data-language":"txt","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"txt","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                  ┌─────────────────────┐      ┌─────────────────────┐"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                  │          master     │ ---- │        alone        │ "})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                  └─────────────────────┘      └─────────────────────┘"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                      /   /  |   \\    \\"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                    /    /   |    \\     \\"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                  /     /    |     \\      \\"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                /      /     |      \\       \\"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"             /        /      |       \\        \\"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"           /         /       |        \\         \\"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        /           /        |         \\           \\"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"┌───────┐    ┌───────┐     ┌───────┐  ┌───────┐   ┌───────┐ "})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"│ worker│    │ worker│     │ worker│  │ worker│   │ worker│   ......"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"└───────┘    └───────┘     └───────┘  └───────┘   └───────┘"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"}})})]})}),"\n",(0,r.jsx)(s.h3,{id:"master-进程",children:"Master 进程"}),"\n",(0,r.jsx)(s.p,{children:"主要负责 worker 进程 alone 进程的启动。"}),"\n",(0,r.jsx)(s.h3,{id:"worker-进程",children:"Worker 进程"}),"\n",(0,r.jsx)(s.p,{children:"Worker 进程负责处理真正的用户请求和定时任务的处理，Worker 运行的是业务代码，相对会比 Alone 和 Master 进程上运行的代码复杂度更高，稳定性也低一点，当 Worker 进程异常退出时，Master 进程会重启一个 Worker 进程。"}),"\n",(0,r.jsx)(s.h3,{id:"alone-进程",children:"Alone 进程"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["alone 进程是由 child_process fork 出的一个子进程，",(0,r.jsx)(s.code,{children:"它比较稳定"}),"，只有发生致命错误时才会退出进程。"]}),"\n",(0,r.jsxs)(s.li,{children:["当 alone 发生致命错误导致退出后，会",(0,r.jsx)(s.code,{children:"重新 fork 一个新的 alone 进程继续执行任务"}),"。"]}),"\n",(0,r.jsxs)(s.li,{children:["alone 进程比较适合处理一些需要在",(0,r.jsx)(s.code,{children:"单进程上运行的任务"}),"， 例如定时接口的拉取，定时任务。"]}),"\n",(0,r.jsxs)(s.li,{children:["当你不需要 alone 进程时你也可以选择不启动它，",(0,r.jsx)(s.code,{children:"config.cluster.useAloneWorker = false"})," 即可。"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"alone-进程用法",children:"alone 进程用法"}),"\n",(0,r.jsx)(s.p,{children:"由于 alone 进程比较特殊，这里说明一下 alone 用法。"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["在",(0,r.jsx)(s.code,{children:"根目录 src"})," 下面",(0,r.jsx)(s.code,{children:"创建 alone 文件夹"})]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:["在 ",(0,r.jsx)(s.code,{children:"src/alone"})," 里面新增的文件都会在 ",(0,r.jsx)(s.code,{children:"alone 进程中"}),"执行"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"案例： 在alone进程中创建一个定时器任务"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"ts","data-theme":"default",filename:"src/alone/setInterval.ts",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"ts","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Alone"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(config"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"any"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" i "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"0"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"setInterval"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(() "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'console alone worker msg:'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" i"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"++"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"3000"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"备注："}),"\n"]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"alone 文件夹下可以创建多个文件任务"}),"\n",(0,r.jsx)(s.li,{children:"文件必须以函数形式进行导出"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"master-vs-alone-vs-worker",children:"Master VS Alone VS Worker"}),"\n",(0,r.jsx)(s.p,{children:"开启集群模式时，应用启动会启动这三类进程。"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"类型"}),(0,r.jsx)(s.th,{children:"进程数量"}),(0,r.jsx)(s.th,{children:"作用"}),(0,r.jsx)(s.th,{children:"稳定性"}),(0,r.jsx)(s.th,{children:"是否运行业务代码"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Master"}),(0,r.jsx)(s.td,{children:"1"}),(0,r.jsx)(s.td,{children:"进程管理，进程间消息转发"}),(0,r.jsx)(s.td,{children:"非常高"}),(0,r.jsx)(s.td,{children:"否"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Alone"}),(0,r.jsx)(s.td,{children:"1"}),(0,r.jsx)(s.td,{children:"后台运行工作"}),(0,r.jsx)(s.td,{children:"高"}),(0,r.jsx)(s.td,{children:"少量"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Worker"}),(0,r.jsx)(s.td,{children:"n"}),(0,r.jsx)(s.td,{children:"执行业务代码"}),(0,r.jsx)(s.td,{children:"一般"}),(0,r.jsx)(s.td,{children:"是"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"进程间通信",children:"进程间通信"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"worker"})," 进程是 node.js 模块中的 ",(0,r.jsx)(s.code,{children:"cluster fork 出来的 worker 进程"}),"，因此它可以和 app 进程进行通信"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"alone"})," 进程是使用 node.js 模块中的 ",(0,r.jsx)(s.code,{children:"child_process fork出来的worker进程"}),"，因此它也可以和 app 进程进行通信"]}),"\n",(0,r.jsxs)(s.li,{children:["因为进程间是独立的，worker 进程和 alone 进程也没有父子级关系，因此",(0,r.jsx)(s.code,{children:"它们之间不能相互通信"}),"。要做到相互通信需要",(0,r.jsx)(s.code,{children:"通过 app 进程进行转发"}),"，转发规则可看下面代码示例。"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"worker-进程给-alone-进程发送消息",children:"worker 进程给 alone 进程发送消息"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"先安装依赖"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"shell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsx)(s.code,{"data-language":"shell","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"yarn "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"add"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"sendmessage"})]})})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"代码示例"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"ts","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"ts","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// worker 进程代码 发送消息"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"sendmessage"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"require"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'sendmessage'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"sendmessage"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(process"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  action"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker-to-alone'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  to"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'alone'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  data"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'from worker msg to alone process'"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// alone 进程代码 接受消息"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"process"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".on"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'message'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(msg) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"action"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"to"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" msg "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"||"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {}"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(action "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker-to-alone'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" from "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" to "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'alone'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'received msg from worker.msg:'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"msg)"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "})]})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"字段"}),(0,r.jsx)(s.th,{children:"类型"}),(0,r.jsx)(s.th,{children:"说明"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"action"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"自定义事件名称（可随意自定义）"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"from"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsxs)(s.td,{children:["值为 ",(0,r.jsx)(s.code,{children:"worker"}),"， 标识消息来源进程"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"to"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsxs)(s.td,{children:["值为 ",(0,r.jsx)(s.code,{children:"alone"}),"， 标识消息接收进程"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"data"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"any"})}),(0,r.jsx)(s.td,{children:"发送的消息"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"alone-进程给-worker-进程发送消息",children:"alone 进程给 worker 进程发送消息"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"先安装依赖"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"shell","data-theme":"default",hasCopyCode:!0,children:(0,r.jsx)(s.code,{"data-language":"shell","data-theme":"default",children:(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"yarn "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"add"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string)"},children:"sendmessage"})]})})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"代码示例"}),"\n"]}),"\n",(0,r.jsx)(s.pre,{"data-language":"ts","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"ts","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// alone 进程代码 发送消息"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"sendmessage"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"require"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'sendmessage'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"sendmessage"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(process"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"{"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  action"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'alone-to-worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'alone'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  to"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  type"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  data"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'from alone msg to worker process'"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// worker 进程代码 接受消息"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"process"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".on"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'message'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(msg) "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"action"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"to"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"data"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" msg "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"||"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {}"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(action "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'alone-to-worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" from "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'alone'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" to "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'received msg from worker.msg:'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"msg)"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"字段"}),(0,r.jsx)(s.th,{children:"类型"}),(0,r.jsx)(s.th,{children:"说明"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"action"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsx)(s.td,{children:"自定义事件名称（可随意自定义）"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"from"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsxs)(s.td,{children:["值为 ",(0,r.jsx)(s.code,{children:"alone"}),"， 标识消息来源进程"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"to"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsxs)(s.td,{children:["值为 ",(0,r.jsx)(s.code,{children:"worker"}),"，标识接受进程"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"type"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"string"})}),(0,r.jsxs)(s.td,{children:["值为 ",(0,r.jsx)(s.code,{children:"worker 或 all"}),"，worker: 表示消息随机发送给一个worker进程， all: 表示消息发送给所有worker进程 （默认： worker）"]})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"data"}),(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"any"})}),(0,r.jsx)(s.td,{children:"发送的消息"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"定时任务",children:"定时任务"}),"\n",(0,r.jsx)(s.p,{children:"在某些特殊场景下，我们只希望某些逻辑只运行在一个进程中（例如定时任务），yunfly 提供了两种方案来解决这种问题。"}),"\n",(0,r.jsx)(s.h3,{id:"方案一-使用随机的worker单进程运行任务",children:"方案一： 使用随机的worker单进程运行任务"}),"\n",(0,r.jsxs)(s.p,{children:["框架提供了单worker进程运行任务的能力，只需要在代码中监听 ",(0,r.jsx)(s.code,{children:"random-select-worker"})," 事件即可："]}),"\n",(0,r.jsx)(s.pre,{"data-language":"ts","data-theme":"default",hasCopyCode:!0,children:(0,r.jsxs)(s.code,{"data-language":"ts","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 代码案例"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"cluster"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"worker"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".on"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'message'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (msg"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"AnyOptionConfig"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"to"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"action"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" } "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" msg "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"||"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {}"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    from "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'app'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                   "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 确保是app进程发来的消息"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    to "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"&&"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"                  "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 确保是发给worker进程的"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    action "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'random-select-worker'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"   "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 确保是随机选择一个worker执行的事件"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  ) {"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 这里的任务会随机运行在一个worker进程中"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 所以可以在这里执行定时任务"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"  }"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,r.jsx)(s.h3,{id:"方案二-使用-alone-进程运行任务",children:"方案二： 使用 alone 进程运行任务"}),"\n",(0,r.jsx)(s.p,{children:"在alone进程中运行的任务只会在一个进程中运行，它的概念本身就能满足我们的需求。"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"#alone-%E8%BF%9B%E7%A8%8B%E7%94%A8%E6%B3%95",children:"参考 Alone 进程使用方法"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"注意事项："}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["由于进程之间是相互独立的，如果在alone进程执行的任务需要传递给worker进程，则需要做一些进程间通讯的操作。 ",(0,r.jsx)(s.a,{href:"#%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1",children:"参考进程间通信"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"开发环境下的reload策略",children:"开发环境下的reload策略"}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"1、开发环境下，worker进程数始终为1，不能更改"}),"\n",(0,r.jsx)(s.li,{children:"2、开发环境下，不启用refork功能 （即：worker异常退出之后不进行fork新的worker）"}),"\n",(0,r.jsx)(s.li,{children:"3、开发环境reload模式下，只对worker进行进行reload，主进程master 和app进程不进行重启，减少重启耗时"}),"\n",(0,r.jsx)(s.li,{children:"4、开发模式下，不停的更改文件时，触发机制有默认500毫秒的延迟时间，以防止不停重启（此时间可以调整： 配置 cluster.reloadDelay 即可）"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"附录",children:"附录"}),"\n",(0,r.jsx)(s.h3,{id:"cluster-时序图",children:"cluster 时序图"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(a(),{alt:"cluster 时序图",placeholder:"blur",src:d})}),"\n",(0,r.jsx)(s.h3,{id:"cluster启动模型图",children:"cluster启动模型图"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(a(),{alt:"cluster启动模型图",placeholder:"blur",src:h})}),"\n",(0,r.jsx)(s.h3,{id:"服务稳定性保证",children:"服务稳定性保证"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(a(),{alt:"服务稳定性保证",placeholder:"blur",src:x})}),"\n",(0,r.jsx)(s.h3,{id:"cluster启动成功案例",children:"cluster启动成功案例"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(a(),{alt:"cluster启动成功案例",placeholder:"blur",src:k})}),"\n",(0,r.jsx)(s.h3,{id:"多进程负债均衡图",children:"多进程负债均衡图"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(a(),{alt:"多进程负债均衡图",placeholder:"blur",src:p})})]})}let u={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,t.ah)(),e.components);return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(j,{...e})}):j(e)},pageOpts:{filePath:"pages/document/high-function/multi-progress.md",route:"/document/high-function/multi-progress",headings:[{depth:1,value:"多进程模型",id:"多进程模型"},{depth:2,value:"cluster 是什么",id:"cluster-是什么"},{depth:2,value:"使用",id:"使用"},{depth:2,value:"进程分类",id:"进程分类"},{depth:3,value:"Master 进程",id:"master-进程"},{depth:3,value:"Worker 进程",id:"worker-进程"},{depth:3,value:"Alone 进程",id:"alone-进程"},{depth:2,value:"alone 进程用法",id:"alone-进程用法"},{depth:2,value:"Master VS Alone VS Worker",id:"master-vs-alone-vs-worker"},{depth:2,value:"进程间通信",id:"进程间通信"},{depth:3,value:"worker 进程给 alone 进程发送消息",id:"worker-进程给-alone-进程发送消息"},{depth:3,value:"alone 进程给 worker 进程发送消息",id:"alone-进程给-worker-进程发送消息"},{depth:2,value:"定时任务",id:"定时任务"},{depth:3,value:"方案一： 使用随机的worker单进程运行任务",id:"方案一-使用随机的worker单进程运行任务"},{depth:3,value:"方案二： 使用 alone 进程运行任务",id:"方案二-使用-alone-进程运行任务"},{depth:2,value:"开发环境下的reload策略",id:"开发环境下的reload策略"},{depth:2,value:"附录",id:"附录"},{depth:3,value:"cluster 时序图",id:"cluster-时序图"},{depth:3,value:"cluster启动模型图",id:"cluster启动模型图"},{depth:3,value:"服务稳定性保证",id:"服务稳定性保证"},{depth:3,value:"cluster启动成功案例",id:"cluster启动成功案例"},{depth:3,value:"多进程负债均衡图",id:"多进程负债均衡图"}],pageMap:[{kind:"Meta",data:{index:{title:"首页",type:"page",display:"hidden"},document:{title:"文档",type:"page",theme:{}},config:{title:"配置",type:"page"},updatelog:{title:"更新日志",type:"page",href:"https://github.com/yunke-yunfly/yunflyjs/blob/master/CHANGELOG.md",newWindow:!0},faq:{title:"FAQ",type:"page",theme:{toc:!0}}}},{kind:"Folder",name:"config",route:"/config",children:[{kind:"Meta",data:{app:"应用配置",lib:"库配置"}},{kind:"MdxPage",name:"app",route:"/config/app"},{kind:"MdxPage",name:"lib",route:"/config/lib"}]},{kind:"Folder",name:"document",route:"/document",children:[{kind:"Meta",data:{introduction:"介绍","simple-use":"入门篇","basic-function":"基础功能","high-function":"进阶篇",secruity:"安全",quality:"质量",technology:"技术",plugin:"插件",openapi:"OpenAPI",api:"API"}},{kind:"Folder",name:"api",route:"/document/api",children:[{kind:"Meta",data:{apis:"Api",types:"Types"}},{kind:"MdxPage",name:"apis",route:"/document/api/apis"},{kind:"MdxPage",name:"types",route:"/document/api/types"}]},{kind:"Folder",name:"basic-function",route:"/document/basic-function",children:[{kind:"Meta",data:{"directory-struct":"目录结构","config-configure":"Config 配置","plugin-config":"插件配置","middleware-config":"中间件配置",controller:"控制器(Controller)",middleware:"中间件(Middleware)",service:"服务(service)","body-parser":"获取Post参数",logger:"日志","catch-error":"异常处理",lifehook:"生命周期",plugin:"插件","timing-task":"定时任务"}},{kind:"MdxPage",name:"body-parser",route:"/document/basic-function/body-parser"},{kind:"MdxPage",name:"catch-error",route:"/document/basic-function/catch-error"},{kind:"MdxPage",name:"config-configure",route:"/document/basic-function/config-configure"},{kind:"MdxPage",name:"controller",route:"/document/basic-function/controller"},{kind:"MdxPage",name:"directory-struct",route:"/document/basic-function/directory-struct"},{kind:"MdxPage",name:"lifehook",route:"/document/basic-function/lifehook"},{kind:"MdxPage",name:"logger",route:"/document/basic-function/logger"},{kind:"MdxPage",name:"middleware-config",route:"/document/basic-function/middleware-config"},{kind:"MdxPage",name:"middleware",route:"/document/basic-function/middleware"},{kind:"MdxPage",name:"plugin-config",route:"/document/basic-function/plugin-config"},{kind:"MdxPage",name:"plugin",route:"/document/basic-function/plugin"},{kind:"MdxPage",name:"service",route:"/document/basic-function/service"},{kind:"MdxPage",name:"timing-task",route:"/document/basic-function/timing-task"}]},{kind:"Folder",name:"high-function",route:"/document/high-function",children:[{kind:"Meta",data:{"local-dev":"本地开发","unit-test":"单元测试","err-class-use":"错误类使用",context:"Context 活动对象","param-trans":"参数透传","link-trace":"链路追踪","plugin-dev":"插件开发","multi-progress":"多进程模型","framework-dev":"框架开发"}},{kind:"MdxPage",name:"context",route:"/document/high-function/context"},{kind:"MdxPage",name:"err-class-use",route:"/document/high-function/err-class-use"},{kind:"MdxPage",name:"framework-dev",route:"/document/high-function/framework-dev"},{kind:"MdxPage",name:"link-trace",route:"/document/high-function/link-trace"},{kind:"MdxPage",name:"local-dev",route:"/document/high-function/local-dev"},{kind:"MdxPage",name:"multi-progress",route:"/document/high-function/multi-progress"},{kind:"MdxPage",name:"param-trans",route:"/document/high-function/param-trans"},{kind:"MdxPage",name:"plugin-dev",route:"/document/high-function/plugin-dev"},{kind:"MdxPage",name:"unit-test",route:"/document/high-function/unit-test"}]},{kind:"Folder",name:"introduction",route:"/document/introduction",children:[{kind:"Meta",data:{introduce:"介绍",characteristic:"特性","framework-differences":"与社区框架差异",performance:"性能"}},{kind:"MdxPage",name:"characteristic",route:"/document/introduction/characteristic"},{kind:"MdxPage",name:"framework-differences",route:"/document/introduction/framework-differences"},{kind:"MdxPage",name:"introduce",route:"/document/introduction/introduce"},{kind:"MdxPage",name:"performance",route:"/document/introduction/performance"}]},{kind:"Folder",name:"openapi",route:"/document/openapi",children:[{kind:"Meta",data:{openapi:"框架生成OpenAPI数据",jsonschema:"ts生成JsonSchema数据",request:"OpenAPI数据生成前端代码"}},{kind:"MdxPage",name:"jsonschema",route:"/document/openapi/jsonschema"},{kind:"MdxPage",name:"openapi",route:"/document/openapi/openapi"},{kind:"MdxPage",name:"request",route:"/document/openapi/request"}]},{kind:"Folder",name:"plugin",route:"/document/plugin",children:[{kind:"Meta",data:{"body-parser":"body-parser",error:"error","current-context":"current-context",apm:"apm",jwt:"jwt",secruity:"secruity",redis:"redis",prisma:"prisma","rate-limiter":"rate-limiter"}},{kind:"MdxPage",name:"apm",route:"/document/plugin/apm"},{kind:"MdxPage",name:"body-parser",route:"/document/plugin/body-parser"},{kind:"MdxPage",name:"current-context",route:"/document/plugin/current-context"},{kind:"MdxPage",name:"error",route:"/document/plugin/error"},{kind:"MdxPage",name:"jwt",route:"/document/plugin/jwt"},{kind:"MdxPage",name:"prisma",route:"/document/plugin/prisma"},{kind:"MdxPage",name:"rate-limiter",route:"/document/plugin/rate-limiter"},{kind:"MdxPage",name:"redis",route:"/document/plugin/redis"},{kind:"MdxPage",name:"secruity",route:"/document/plugin/secruity"}]},{kind:"Folder",name:"quality",route:"/document/quality",children:[{kind:"Meta",data:{"unit-test":"Unit-Test",eslint:"Eslint",commit:"Commit",cspell:"Cspell",notes:"Notes"}},{kind:"MdxPage",name:"commit",route:"/document/quality/commit"},{kind:"MdxPage",name:"cspell",route:"/document/quality/cspell"},{kind:"MdxPage",name:"eslint",route:"/document/quality/eslint"},{kind:"MdxPage",name:"notes",route:"/document/quality/notes",frontMatter:{sidebar_position:5}},{kind:"MdxPage",name:"unit-test",route:"/document/quality/unit-test"}]},{kind:"Folder",name:"secruity",route:"/document/secruity",children:[{kind:"Meta",data:{jwt:"JWT",whitelist:"Whitelist",methods:"Methods",xss:"XSS",csrf:"CSRF",xframe:"Xframe",hsts:"Hsts",cors:"CORS",csp:"CSP",validator:"Validator","rate-limiter":"限流",fusing:"熔断"}},{kind:"MdxPage",name:"cors",route:"/document/secruity/cors",frontMatter:{sidebar_position:8}},{kind:"MdxPage",name:"csp",route:"/document/secruity/csp"},{kind:"MdxPage",name:"csrf",route:"/document/secruity/csrf"},{kind:"MdxPage",name:"fusing",route:"/document/secruity/fusing"},{kind:"MdxPage",name:"hsts",route:"/document/secruity/hsts"},{kind:"MdxPage",name:"jwt",route:"/document/secruity/jwt"},{kind:"MdxPage",name:"methods",route:"/document/secruity/methods",frontMatter:{sidebar_position:3}},{kind:"MdxPage",name:"rate-limiter",route:"/document/secruity/rate-limiter"},{kind:"MdxPage",name:"validator",route:"/document/secruity/validator"},{kind:"MdxPage",name:"whitelist",route:"/document/secruity/whitelist",frontMatter:{sidebar_position:2}},{kind:"MdxPage",name:"xframe",route:"/document/secruity/xframe"},{kind:"MdxPage",name:"xss",route:"/document/secruity/xss"}]},{kind:"Folder",name:"simple-use",route:"/document/simple-use",children:[{kind:"Meta",data:{env:"环境准备","quickly-start":"快速开始","gradually-build":"逐步搭建"}},{kind:"MdxPage",name:"env",route:"/document/simple-use/env"},{kind:"MdxPage",name:"gradually-build",route:"/document/simple-use/gradually-build"},{kind:"MdxPage",name:"quickly-start",route:"/document/simple-use/quickly-start"}]},{kind:"Folder",name:"technology",route:"/document/technology",children:[{kind:"Meta",data:{grpc:"grpc",http:"http",apm:"elastic-apm",prometheus:"Prometheus",redis:"Redis",prisma:"prisma",socket:"Socket"}},{kind:"MdxPage",name:"apm",route:"/document/technology/apm"},{kind:"MdxPage",name:"grpc",route:"/document/technology/grpc"},{kind:"MdxPage",name:"http",route:"/document/technology/http"},{kind:"MdxPage",name:"prisma",route:"/document/technology/prisma"},{kind:"MdxPage",name:"prometheus",route:"/document/technology/prometheus",frontMatter:{sidebar_position:4}},{kind:"MdxPage",name:"redis",route:"/document/technology/redis"},{kind:"MdxPage",name:"socket",route:"/document/technology/socket"}]}]},{kind:"MdxPage",name:"faq",route:"/faq"},{kind:"MdxPage",name:"index",route:"/"}],flexsearch:{codeblocks:!0},title:"多进程模型"},pageNextRoute:"/document/high-function/multi-progress",nextraLayout:l.ZP,themeConfig:o.Z};var y=(0,i.j)(u)}},function(e){e.O(0,[9774,3331,2888,179],function(){return e(e.s=3912)}),_N_E=e.O()}]);